<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Pwcx's blog</title><meta name="author" content="Pwcx"><meta name="copyright" content="Pwcx"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta property="og:type" content="website">
<meta property="og:title" content="Pwcx&#39;s blog">
<meta property="og:url" content="https://pwcx.github.io/page/2/index.html">
<meta property="og:site_name" content="Pwcx&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pwcx.github.io/img/5.png">
<meta property="article:author" content="Pwcx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pwcx.github.io/img/5.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://pwcx.github.io/page/2/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isSidebar: false,
  postUpdate: '2021-05-16 20:15:48'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><div class="aplayer" data-id="87200602" data-server="netease" data-type="playlist" data-fixed="true" data-listFolded="false" data-order="random" data-preload="none"></div><link rel="stylesheet" href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css"><script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@1.2.0/dist/Meting.min.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/5.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">75</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">43</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-feather"></i><span> 留言板</span></a></div></div></div></div><div id="body-wrap"><div id="web_bg"></div><header class="full_page" id="page-header" style="background-image: url(/img/2.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Pwcx's blog</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-feather"></i><span> 留言板</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="site-info"><h1 id="site-title">Pwcx's blog</h1><div id="site-subtitle"><span id="subtitle"></span></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout_page" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/12/09/Win32%E7%BC%96%E7%A8%8B-%E8%87%AA%E5%90%AF%E5%8A%A8%E6%8A%80%E6%9C%AF/" title="Win32编程-自启动技术">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Win32编程-自启动技术"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/09/Win32%E7%BC%96%E7%A8%8B-%E8%87%AA%E5%90%AF%E5%8A%A8%E6%8A%80%E6%9C%AF/" title="Win32编程-自启动技术">Win32编程-自启动技术</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2020-12-09T04:55:30.000Z" title="Created 2020-12-09 12:55:30">2020-12-09</time></span></div><div class="content">注册表通过修改注册表实现开机自启动参考资料：Windows注册表内容详解（转载）
ctrl + R 打开运行，输入regedit可以打开注册表，一开始显示的是5个根键

待会要用到的RegOpenKeyEx()函数要用到上面五个根键之一，至于这五个根键有啥区别，看上面的资料了解一下，照搬也没啥用
RegOpenKeyEx
函数定义：
1234567&gt;LONG RegOpenKeyEx(            HKEY hKey,         // 已经打开键的句柄            LPCTSTR lpSubKey,  // 子键的名称            DWORD ulOptions,   // 保留            REGSAM samDesired, // 安全访问标记            PHKEY phkResult    // 指向将要打开键的句柄&gt;);

函数功能：打开一个指定的注册表键
对几个参数进行简单的解释
lpSubKey：指向一个非中断字符串将要打开键的名称。
ulOptions: 保留，必须设置为0
这里要用的安全访问标记为 K ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/12/08/Win32%E7%BC%96%E7%A8%8B-%E6%A8%A1%E6%8B%9F%E9%94%AE%E7%9B%98%E9%BC%A0%E6%A0%87%E6%B6%88%E6%81%AF/" title="Win32编程-模拟键盘鼠标消息">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Win32编程-模拟键盘鼠标消息"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/08/Win32%E7%BC%96%E7%A8%8B-%E6%A8%A1%E6%8B%9F%E9%94%AE%E7%9B%98%E9%BC%A0%E6%A0%87%E6%B6%88%E6%81%AF/" title="Win32编程-模拟键盘鼠标消息">Win32编程-模拟键盘鼠标消息</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2020-12-08T10:52:53.000Z" title="Created 2020-12-08 18:52:53">2020-12-08</time></span></div><div class="content">模拟键盘消息看书看到模拟鼠标键盘消息的内容，来学一学，说不定学完之后能写个游戏挂机脚本呢..
先介绍有关API
FindWindow()函数：返回当前窗口标题为lpWindowName(参数二)的窗口句柄
SetForegroundWindow()函数：将指定的窗口设置到最前面并处于激活状态
PostMessage()函数：可以对指定的窗口发送消息。消息包括键盘消息和鼠标消息
SendMessage()函数： 跟PostMessage作用类似
实验代码:
12345678910111213141516171819202122232425262728293031#include&lt;cstdio&gt;#include&lt;cstdlib&gt;s#include&lt;cstring&gt;#include&lt;iostream&gt;#include&lt;Windows.h&gt;using namespace std;CONST CHAR *gTitle = &quot;CHAOS;CHILD&quot;;CONST CHAR *gPath = &quot;E:\\Baid ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/12/03/%E6%83%B3%E5%AD%A6%E5%95%A5%E5%B0%B1%E5%AD%A6%E5%95%A5%E4%B9%8BWin32%E7%BC%96%E7%A8%8B/" title="想学啥就学啥之Win32编程">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="想学啥就学啥之Win32编程"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/12/03/%E6%83%B3%E5%AD%A6%E5%95%A5%E5%B0%B1%E5%AD%A6%E5%95%A5%E4%B9%8BWin32%E7%BC%96%E7%A8%8B/" title="想学啥就学啥之Win32编程">想学啥就学啥之Win32编程</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2020-12-03T12:10:41.000Z" title="Created 2020-12-03 20:10:41">2020-12-03</time></span></div><div class="content">In 与 _In_opt_ 宏的意义
#define _In_
#define _In_opt_
也就是说,这两个宏定义实际上就相当于没有.那么为什么还要定义?这是为了说明这个参数是一个输入参数还是一个输出参数,_In_表示这是一个输入给函数的参数,意思是在函数执行之前你需要设定它的值,函数会使用这个值来进行某些处理,而_Out_表示这是一个从函数中输出的参数,你事先不需要设定它的值,函数在经过一些操作后,你可以从这个参数中获取你想要的数据.而_opt_表示这个参数是可选的,意思就是可有可无,如果你不需要该参数,那么通常传入0.
出处：https://www.bilibili.com/read/cv286564/
#pragmaonce 宏的作用
为了避免同一个头文件被包含（include）多次，C/C++中有两种宏实现方式：一种是#ifndef方式；另一种是#pragma once方式
CreateMutex() 创建互斥对象123456789101112131415161718192021222324252627#include &quot;stdafx.h&quot;#inclu ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/10/25/10-24-%E4%B8%A4%E9%81%93Pwn%E9%A2%98%E7%9A%84Write-up/" title="10.24 两道Pwn题的Write-up">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="10.24 两道Pwn题的Write-up"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/10/25/10-24-%E4%B8%A4%E9%81%93Pwn%E9%A2%98%E7%9A%84Write-up/" title="10.24 两道Pwn题的Write-up">10.24 两道Pwn题的Write-up</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2020-10-25T03:39:35.000Z" title="Created 2020-10-25 11:39:35">2020-10-25</time></span></div><div class="content">pwn1程序分析:

将程序丢进IDA发现加载速度比较慢，加载出来后有非常多的函数，初步判断是个静态链接的文件，快速浏览了下所有函数，只有start是个正常的名称，其他均是IDA的函数命名方式，可以看出已经剥离了符号表


对程序有个大概印象后，先找main函数在哪
程序的入口一般先从start函数开始，在start函数内部还会调用__libc_start_main函数，在调用这个函数的时候，如果是64位的程序，rdi寄存器存放的就是main函数的地址，根据这一点直接查看start函数的汇编代码就可以找到main函数的地址了




找到main函数后按F5生成伪代码，很容易可以看出sub_43F2E0是个read函数，并且缓存区太大，造成了栈溢出，结合程序保护，我比较直接的想用rop来做



解题思路

因为是静态链接，像system函数之类的地址都在文件里面，不过去除了符号表，要找出这个函数费时费力，所以我选择直接找gadget来执行系统调用

大体思路为先调用read 往bss段写入 “/bin/sh\0” ，之后再调用execve 来getshell。gadget 通过ROP ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/10/24/hello-world/" title="Hello World">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/10/24/hello-world/" title="Hello World">Hello World</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2020-10-24T08:49:23.516Z" title="Created 2020-10-24 16:49:23">2020-10-24</time></span></div><div class="content">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.
Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;

More info: Writing
Run server1$ hexo server

More info: Server
Generate static files1$ hexo generate

More info: Generating
Deploy to remote sites1$ hexo deploy

More info: Deployment
</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/10/21/HacktheBox-%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85/" title="HacktheBox 刷题之旅">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HacktheBox 刷题之旅"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/10/21/HacktheBox-%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85/" title="HacktheBox 刷题之旅">HacktheBox 刷题之旅</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2020-10-21T03:38:50.000Z" title="Created 2020-10-21 11:38:50">2020-10-21</time></span></div><div class="content">Web学习这位师傅的writeup：https://blog.ncu204.com/post/
hackthebox 获取邀请码：查看网页源码发现一段js代码，带有invite提示，不过可读性很差，放到xor网站中美化一下代码，如下
function makeInviteCode() {    $.ajax({        type: “POST”,        dataType: “json”,        url: ‘/api/invite/how/to/generate’,        success: function (a) {            console.log(a)        },        error: function (a) {            console.log(a)        }    })}
发现是个函数，在console中运行这个函数，可以获得一段加密后的密文，密文后面有说明是那种加密方式
提示是ROT13加密，把密文放到Rot13解密的网站上跑一下
解出来的明文提示要发送一个POST请求到 “/api/invite/ ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/09/11/Pwn-%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E6%80%BB%E6%B1%87/" title="Pwn 工具安装总汇">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Pwn 工具安装总汇"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/09/11/Pwn-%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E6%80%BB%E6%B1%87/" title="Pwn 工具安装总汇">Pwn 工具安装总汇</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2020-09-11T03:11:44.000Z" title="Created 2020-09-11 11:11:44">2020-09-11</time></span></div><div class="content">pwntoolssudo apt-get updatesudo apt-get install python3 python3-pip python3-dev git libssl-dev libffi-dev build-essentialpython3 -m pip install –upgrade pippython3 -m pip install –upgrade pwntools
官网：http://docs.pwntools.com/en/stable/install.html
pwndbggit clone https://github.com/pwndbg/pwndbgcd pwndbg/./setup.sh
各版本libc下载https://github.com/matrix1001/welpwn/tree/master/PwnContext/libs
64位机器上运行编译32程序方法sudo apt install libc6:i386sudo apt install libstdc++6:i386或者直接安装gcc-multilib解决问题（推荐使用此方法）sud ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/09/08/DozerCTF-%E9%85%B8%E8%8F%9C%E9%B1%BC%20%E5%A4%8D%E7%8E%B0/" title="DozerCTF 酸菜鱼">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DozerCTF 酸菜鱼"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/09/08/DozerCTF-%E9%85%B8%E8%8F%9C%E9%B1%BC%20%E5%A4%8D%E7%8E%B0/" title="DozerCTF 酸菜鱼">DozerCTF 酸菜鱼</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2020-09-08T05:32:38.000Z" title="Created 2020-09-08 13:32:38">2020-09-08</time></span></div><div class="content">学习的各位大师傅的博客：DozerCTF利用 _IO_2_1_stdout_ 泄露信息
酸菜鱼程序保护
​    Arch:     amd64-64-little​    RELRO:    Full RELRO​    Stack:    Canary found​    NX:       NX enabled​    PIE:      PIE enabled
漏洞点
在delete函数中有uaf漏洞，虽然程序没有给空间存放chunk的地址，但是可以通过edit函数在mmap的地址处伪造chunk
解题思路

通过unsorted bin attack打global_max_fast，这样后面可以伪造一个大小较大的chunk，由于修改了global_max_fast，fastbin的链表地址会随着chunk的大小不断延伸，这样就可以控制_IO_2_1_stdout_中的 IO_read_end 与 IO_write_base__，控制 __IO_read_end == __IO_write_base 就可以泄露libc地址

 需要注意的是在修改了stdout结构体后程序会没有 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF-veryeasy-writeup/" title="钓鱼城杯 veryeasy writeup">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="钓鱼城杯 veryeasy writeup"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E%E6%9D%AF-veryeasy-writeup/" title="钓鱼城杯 veryeasy writeup">钓鱼城杯 veryeasy writeup</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2020-08-27T14:07:52.000Z" title="Created 2020-08-27 22:07:52">2020-08-27</time></span></div><div class="content">veryeasy程序保护    Arch:     amd64-64-little    RELRO:    Full RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      PIE enabled
漏洞点在delete函数中那个if判断可以通过create10次来绕过，以及free后没有把指针置为0，有uaf
解题思路因为是libc 2.27，又有uaf漏洞，思路比较简单，这里就记一下覆盖_IO_2_1_stdout_结构体的payload，在这里踩了一坑。。。p64(0xfbad1800) + p64(0) * 3 + &quot;\x00&quot;
exp:
1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909 ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/2020/08/26/ciscn2020-%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0%20&amp;%20%E5%BC%BA%E7%BD%91%E6%9D%AF%20%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/" title="ciscn2020 部分题目复现 &amp; 强网杯 部分题目复现">     <img class="post_bg" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ciscn2020 部分题目复现 &amp; 强网杯 部分题目复现"></a></div><div class="recent-post-info"><a class="article-title" href="/2020/08/26/ciscn2020-%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0%20&amp;%20%E5%BC%BA%E7%BD%91%E6%9D%AF%20%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E5%A4%8D%E7%8E%B0/" title="ciscn2020 部分题目复现 &amp; 强网杯 部分题目复现">ciscn2020 部分题目复现 &amp; 强网杯 部分题目复现</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2020-08-26T06:20:12.000Z" title="Created 2020-08-26 14:20:12">2020-08-26</time></span></div><div class="content">easybox程序保护    Arch:     amd64-64-little    RELRO:    Full RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      PIE enabled
漏洞点
在add功能的函数中size很明显的加了一，存在off by one 漏洞
解题思路
构造chunk overlap, 劫持_IO_2_1_stdout结构体，泄露libc地址，时候再通过fast bin attack来打malloc_hook最后getshell
具体构造chunk overlap的过程

add(0, 0xf8, ‘\n’)add(1, 0x18, ‘\n’)add(2, 0x68, ‘\n’)add(3, 0xf8, ‘\n’)add(4, 0x18, ‘\n’)首先创建这么多chunk


free(0)
free(2)add(2, 0x68, ‘\x00’ * 0x60 + p64(0x190) + ‘\x00’)
free(3)先让chunk0进入unsorted bin，再 ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/5.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Pwcx</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">75</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">43</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div></div><div class="sticky_layout"><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">Welcome to 吃饭睡觉摸鱼人's blog.</div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/05/16/CISCN%E5%9B%BD%E8%B5%9B%E5%88%9D%E8%B5%9BPWN/" title="CISCN国赛初赛PWN"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CISCN国赛初赛PWN"/></a><div class="content"><a class="title" href="/2021/05/16/CISCN%E5%9B%BD%E8%B5%9B%E5%88%9D%E8%B5%9BPWN/" title="CISCN国赛初赛PWN">CISCN国赛初赛PWN</a><time datetime="2021-05-16T08:29:35.000Z" title="Created 2021-05-16 16:29:35">2021-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/27/windows%E7%BC%96%E7%A8%8B-%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/" title="windows编程 相关知识"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="windows编程 相关知识"/></a><div class="content"><a class="title" href="/2021/03/27/windows%E7%BC%96%E7%A8%8B-%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/" title="windows编程 相关知识">windows编程 相关知识</a><time datetime="2021-03-27T07:28:36.000Z" title="Created 2021-03-27 15:28:36">2021-03-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/26/Windows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B-Process-Information/" title="Windows核心编程 Process Information"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Windows核心编程 Process Information"/></a><div class="content"><a class="title" href="/2021/03/26/Windows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B-Process-Information/" title="Windows核心编程 Process Information">Windows核心编程 Process Information</a><time datetime="2021-03-26T10:49:15.000Z" title="Created 2021-03-26 18:49:15">2021-03-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/19/%E4%BD%BF%E7%94%A8Windows%E6%8C%82%E9%92%A9%E6%9D%A5%E6%B3%A8%E5%85%A5DLL/" title="使用Windows挂钩来注入DLL"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用Windows挂钩来注入DLL"/></a><div class="content"><a class="title" href="/2021/03/19/%E4%BD%BF%E7%94%A8Windows%E6%8C%82%E9%92%A9%E6%9D%A5%E6%B3%A8%E5%85%A5DLL/" title="使用Windows挂钩来注入DLL">使用Windows挂钩来注入DLL</a><time datetime="2021-03-19T12:50:56.000Z" title="Created 2021-03-19 20:50:56">2021-03-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/17/Windows%E5%AE%89%E5%85%A8%E7%BC%96%E7%A8%8B-SEH-HOOK%E6%8B%A6%E6%88%AA%E4%BB%BB%E6%84%8FAPI/" title="Windows安全编程-SEH HOOK拦截任意API"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Windows安全编程-SEH HOOK拦截任意API"/></a><div class="content"><a class="title" href="/2021/03/17/Windows%E5%AE%89%E5%85%A8%E7%BC%96%E7%A8%8B-SEH-HOOK%E6%8B%A6%E6%88%AA%E4%BB%BB%E6%84%8FAPI/" title="Windows安全编程-SEH HOOK拦截任意API">Windows安全编程-SEH HOOK拦截任意API</a><time datetime="2021-03-17T10:52:08.000Z" title="Created 2021-03-17 18:52:08">2021-03-17</time></div></div></div></div></div><div class="card-widget card-tags"><div class="card-content"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/2-23-chunk-overlap%EF%BC%8C-house-of-orange-%E5%A0%86%E6%BA%A2%E5%87%BA%EF%BC%8C%E4%BF%AE%E6%94%B9rbp%E6%9D%A5%E8%B7%B3%E8%BD%AC%E5%88%B0start/" style="font-size: 1.1em; color: #999">2.23_chunk_overlap， house of orange, 堆溢出，修改rbp来跳转到start</a> <a href="/tags/2019%E6%8A%A4%E7%BD%91%E6%9D%AF%EF%BC%8C-malloc-consolidate/" style="font-size: 1.1em; color: #999">2019护网杯， malloc_consolidate</a> <a href="/tags/CTF%EF%BC%8C%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%EF%BC%8C%E5%A0%86%E6%BA%A2%E5%87%BA/" style="font-size: 1.1em; color: #999">CTF，静态链接，堆溢出</a> <a href="/tags/DLL%E6%8C%82%E9%92%A9%E6%B3%A8%E5%85%A5/" style="font-size: 1.1em; color: #999">DLL挂钩注入</a> <a href="/tags/Hgame2020%EF%BC%8C-chunk-overlap/" style="font-size: 1.1em; color: #999">Hgame2020， chunk overlap</a> <a href="/tags/IO-2-1-stdout-fast-bin/" style="font-size: 1.1em; color: #999">IO_2_1_stdout, fast bin</a> <a href="/tags/Netword-Programming/" style="font-size: 1.1em; color: #999">Netword Programming</a> <a href="/tags/PWN/" style="font-size: 1.3em; color: #99a1ac">PWN</a> <a href="/tags/PWN-Hgame/" style="font-size: 1.1em; color: #999">PWN, Hgame</a> <a href="/tags/PWN-XMAN-2019/" style="font-size: 1.1em; color: #999">PWN, XMAN_2019</a> <a href="/tags/PWN-buuoj/" style="font-size: 1.1em; color: #999">PWN, buuoj</a> <a href="/tags/PWN%EF%BC%8CHgame2020/" style="font-size: 1.1em; color: #999">PWN，Hgame2020</a> <a href="/tags/SROP-%E4%BC%AA%E9%80%A0prev-size%E5%90%88%E5%B9%B6chunk-malloc-solidate/" style="font-size: 1.1em; color: #999">SROP, 伪造prev_size合并chunk, malloc_solidate</a> <a href="/tags/Win32%E7%BC%96%E7%A8%8B%EF%BC%8C%E9%94%AE%E7%9B%98%E8%AE%B0%E5%BD%95%E5%99%A8/" style="font-size: 1.1em; color: #999">Win32编程，键盘记录器</a> <a href="/tags/Windows%E7%BC%96%E7%A8%8B/" style="font-size: 1.5em; color: #99a9bf">Windows编程</a> <a href="/tags/XSS-DVWA/" style="font-size: 1.1em; color: #999">XSS, DVWA</a> <a href="/tags/buuoj-PWN/" style="font-size: 1.1em; color: #999">buuoj, PWN</a> <a href="/tags/double-free-uaf/" style="font-size: 1.1em; color: #999">double free, uaf</a> <a href="/tags/dvwa1-10-sql%E7%9B%B2%E6%B3%A8-kali%E9%85%8D%E7%BD%AEDVWA/" style="font-size: 1.1em; color: #999">dvwa1.10, sql盲注, kali配置DVWA</a> <a href="/tags/dvwa1-10%EF%BC%8Ccsrf/" style="font-size: 1.1em; color: #999">dvwa1.10，csrf</a> <a href="/tags/environ-64%E4%BD%8D%E5%85%A8%E6%98%AF%E5%8F%AF%E8%A7%81%E5%AD%97%E7%AC%A6%E7%9A%84shellcode/" style="font-size: 1.1em; color: #999">environ, 64位全是可见字符的shellcode</a> <a href="/tags/fmtstr-payload-LibcSearcher/" style="font-size: 1.1em; color: #999">fmtstr_payload, LibcSearcher</a> <a href="/tags/global-max-fast-fastbin%E9%93%BE%E8%A1%A8%E6%94%BB%E5%87%BB/" style="font-size: 1.1em; color: #999">global_max_fast, fastbin链表攻击</a> <a href="/tags/javascript/" style="font-size: 1.1em; color: #999">javascript</a> <a href="/tags/libc2-27-chunk-overlap/" style="font-size: 1.1em; color: #999">libc2.27, chunk overlap</a> <a href="/tags/libc2-27%E7%88%86%E7%A0%B4-IO-2-1-stdout/" style="font-size: 1.1em; color: #999">libc2.27爆破_IO_2_1_stdout_</a> <a href="/tags/off-by-one-%E4%BF%AE%E6%94%B9prev-size/" style="font-size: 1.1em; color: #999">off by one, 修改prev_size</a> <a href="/tags/pwn-off-by-one/" style="font-size: 1.1em; color: #999">pwn, off-by-one</a> <a href="/tags/ret2dl-reslove-%E7%BB%95%E8%BF%87canary/" style="font-size: 1.1em; color: #999">ret2dl-reslove, 绕过canary</a> <a href="/tags/rust/" style="font-size: 1.1em; color: #999">rust</a> <a href="/tags/setcontext-orw-mprotect/" style="font-size: 1.1em; color: #999">setcontext, orw, mprotect</a> <a href="/tags/sql%E6%B3%A8%E5%85%A5%EF%BC%8CDVWA1-10/" style="font-size: 1.1em; color: #999">sql注入，DVWA1.10</a> <a href="/tags/ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/" style="font-size: 1.1em; color: #999">ssti模板注入</a> <a href="/tags/tcache-struct-attack/" style="font-size: 1.1em; color: #999">tcache struct attack</a> <a href="/tags/unlink/" style="font-size: 1.1em; color: #999">unlink</a> <a href="/tags/unlink-libc2-23/" style="font-size: 1.1em; color: #999">unlink, libc2.23</a> <a href="/tags/unlink-unsorted-bin-attack/" style="font-size: 1.1em; color: #999">unlink, unsorted bin attack</a> <a href="/tags/unsorted-bin-attack-%E4%BF%AE%E6%94%B9global-max-fast/" style="font-size: 1.1em; color: #999">unsorted bin attack, 修改global_max_fast</a> <a href="/tags/windows%E7%BC%96%E7%A8%8B/" style="font-size: 1.1em; color: #999">windows编程</a> <a href="/tags/wireshark%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%EF%BC%8C-ARP%E6%AC%BA%E9%AA%97%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E8%B7%B5/" style="font-size: 1.1em; color: #999">wireshark基本操作， ARP欺骗原理与实践</a></div></div></div><div class="card-widget card-archives"><div class="card-content"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/05/"><span class="card-archive-list-date">May 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/03/"><span class="card-archive-list-date">March 2021</span><span class="card-archive-list-count">8</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/01/"><span class="card-archive-list-date">January 2021</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/12/"><span class="card-archive-list-date">December 2020</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/10/"><span class="card-archive-list-date">October 2020</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/09/"><span class="card-archive-list-date">September 2020</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/08/"><span class="card-archive-list-date">August 2020</span><span class="card-archive-list-count">4</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/07/"><span class="card-archive-list-date">July 2020</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item more is-center"><a class="card-archive-list-link-more" href="/archives/">
              <span>More</span><i class="fas fa-angle-right"  ></i></a></li></ul></div></div><div class="card-widget card-webinfo"><div class="card-content"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article :</div><div class="item-count">75</div></div><div class="webinfo-item"><div class="item-name">Run time :</div><div class="item-count" id="runtimeshow" data-publishDate="2021-05-16T12:15:38.963Z"></div></div><div class="webinfo-item"><div class="item-name">Total Count :</div><div class="item-count">124.6k</div></div><div class="webinfo-item"><div class="item-name">UV :</div><div class="item-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="item-name">PV :</div><div class="item-count" id="busuanzi_value_site_pv"></div></div><div class="webinfo-item"><div class="item-name">Last Push :</div><div class="item-count" id="last-push-date" data-lastPushDate="2021-05-16T12:15:41.146Z"></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Pwcx</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})</script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="https://cdn.jsdelivr.net/gh/WhiteCatRyon/js/upjiang.js"></script><script src="/js/calendar.js"></script><script src="/js/languages.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script></div></body></html>